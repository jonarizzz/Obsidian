Аннотация @Transactional используется для управления [[Транзакция (Transaction)||транзакциями]] в методах или [[Класс (Class)||классах]]. Основное назначение – Обеспечивает [[Атомарность (Atomacy)||атомарность]] операций: либо все изменения в [[Транзакция (Transaction)||транзакции]] выполняются, либо откатываются при ошибке.

### Параметры:

- `propagation` — определяет поведение при наличии активной [[Транзакция (Transaction)||транзакции]]:
	- `REQUIRED`: использует текущую или создает новую.
	- `REQUIRES_NEW`: всегда новая [[Транзакция (Transaction)||транзакция]].
	- `SUPPORTS`: работает с активной или без [[Транзакция (Transaction)||транзакции]].
	- `MANDATORY`: требует активной [[Транзакция (Transaction)||транзакции]].
	- `NEVER`: не должен выполняться внутри [[Транзакция (Transaction)||транзакции]].
	- `NOT_SUPPORTED`: приостанавливает текущую [[Транзакция (Transaction)||транзакцию]].
- `isolation` — [[Уровни Изоляции Транзакций (Transaction Isolation Levels)||уровень изоляции]] (например, `READ_COMMITTED`, `SERIALIZABLE`).
- `timeout` — максимальное время выполнения транзакции.
- `readOnly` — только для чтения.
- `rollbackFor` — исключения, при которых транзакция будет откатана.


### Поведение по умолчанию:

- Откатывает транзакцию при **unchecked** исключениях (например, RuntimeException).
- Не откатывает транзакцию при **проверяемых** исключениях (например, IOException).


### Принцип работы:

1. **Проксирование метода**: Когда метод с аннотацией @Transactional вызывается, фреймворк создает прокси-объект. Прокси перехватывает вызов метода и начинает [[Транзакция (Transaction)||транзакцию]] перед выполнением кода.
2. **Начало транзакции**: Прокси проверяет наличие активной [[Транзакция (Transaction)||транзакции]]. Если её нет, создается новая.
3. **Выполнение метода**: Метод выполняется в рамках [[Транзакция (Transaction)||транзакции]].
4. **Коммит или откат**:
	1. Если метод завершился без ошибок, [[Транзакция (Transaction)||транзакция]] фиксируется (`commit`).
	2. Если метод выбросил исключение, [[Транзакция (Transaction)||транзакция]] откатывается (`rollback`), если исключение подходит под правила отката.
5. **Завершение**: После выполнения метода [[Транзакция (Transaction)||транзакция]] завершена.


### Пример:

```
@Transactional(propagation = Propagation.REQUIRED, isolation = Isolation.READ_COMMITTED)
public void createUser(User user) {
    userRepository.save(user);
    if (user.getId() == null) {
        throw new RuntimeException("Ошибка"); // откат
    }
}
```
