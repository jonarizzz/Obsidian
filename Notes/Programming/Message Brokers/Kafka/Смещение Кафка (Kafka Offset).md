**Kafka Offset** — это уникальный идентификатор [[Сообщение Кафка (Kafka Message)||сообщения]] в [[Раздел Топика Кафка (Kafka Topic Partition)||партиции топика]]. Он указывает на позицию, с которой [[Потребитель Кафка (Kafka Consumer)||потребитель (consumer)]] читает данные в [[Раздел Топика Кафка (Kafka Topic Partition)||партиции]].


### Основные характеристики

- **Отслеживание позиции**: [[Смещение Кафка (Kafka Offset)||Offset]] позволяет отслеживать, какое [[Сообщение Кафка (Kafka Message)||сообщение]] в [[Раздел Топика Кафка (Kafka Topic Partition)||партиции]] было прочитано [[Потребитель Кафка (Kafka Consumer)||потребителем]], что важно для продолжения обработки с того места, где остановился [[Потребитель Кафка (Kafka Consumer)||потребитель]].
- **Уникальность**: Каждое [[Сообщение Кафка (Kafka Message)||сообщение]] в [[Раздел Топика Кафка (Kafka Topic Partition)||партиции]] имеет свой уникальный [[Смещение Кафка (Kafka Offset)||offset]], начиная с `0` для первого [[Сообщение Кафка (Kafka Message)||сообщения]] в [[Раздел Топика Кафка (Kafka Topic Partition)||партиции]].
- **Изменяемость**: [[Потребитель Кафка (Kafka Consumer)||Потребители]] могут сохранять и изменять свой [[Смещение Кафка (Kafka Offset)||offset]] (например, через [[Kafka Zookeeper||Zookeeper]] или [[Группа Потербителей Кафка (Kafka Consumer Group)||Kafka Consumer Group]]), чтобы продолжить с нужного места, даже после перезапуска.


### Как работает

- [[Производитель Кафка (Kafka Producer)||Producer]] отправляет [[Сообщение Кафка (Kafka Message)||сообщения]] в [[Топик Кафка (Kafka Topic)||топик]].
- [[Брокер Кафка (Kafka Broker)||Kafka Broker]] присваивает каждому [[Сообщение Кафка (Kafka Message)||сообщению]] уникальный [[Смещение Кафка (Kafka Offset)||offset]] в пределах [[Раздел Топика Кафка (Kafka Topic Partition)||партиции]].
- [[Потребитель Кафка (Kafka Consumer)||Consumer]] читает [[Сообщение Кафка (Kafka Message)||сообщения]], запрашивая их с определённого [[Смещение Кафка (Kafka Offset)||offset-а]].  


### Пример

Если у вас есть [[Раздел Топика Кафка (Kafka Topic Partition)||партиция]] с [[Сообщение Кафка (Kafka Message)||сообщениями]], присвоенными [[Смещение Кафка (Kafka Offset)||offset-ами]] `0, 1, 2, 3, 4`, то если [[Потребитель Кафка (Kafka Consumer)||потребитель]] прочитает [[Сообщение Кафка (Kafka Message)||сообщение]] с `offset = 2`, следующий запрос для получения следующего [[Сообщение Кафка (Kafka Message)||сообщения]] будет с `offset = 3`.


### Где хранится

- **В [[Кафка (Apache Kafka)||Kafka]] (внутри самой [[Кафка (Apache Kafka)||Kafka]])** — начиная с версии Kafka 0.9, [[Смещение Кафка (Kafka Offset)||offsetы]] могут храниться внутри [[Кафка (Apache Kafka)||Kafka]]. Это делается с помощью специального [[Топик Кафка (Kafka Topic)||топика]]  `_consumer_offsets`, где [[Кафка (Apache Kafka)||Kafka]] сохраняет последние успешно прочитанные [[Смещение Кафка (Kafka Offset)||offsetы]] для каждой [[Группа Потербителей Кафка (Kafka Consumer Group)||группы потребителей]].
	- Это позволяет [[Потребитель Кафка (Kafka Consumer)||потребителям]] восстанавливать своё состояние после перезапуска или сбоя, используя информацию, сохранённую в этом [[Топик Кафка (Kafka Topic)||топике]].
	- Каждый [[Потребитель Кафка (Kafka Consumer)||consumer group]] хранит свои [[Смещение Кафка (Kafka Offset)||offsetы]] для каждого [[Топик Кафка (Kafka Topic)||топика]] и каждой [[Раздел Топика Кафка (Kafka Topic Partition)||партиции]].
	  
- **В [[Kafka Zookeeper||Zookeeper]] (для старых версий [[Кафка (Apache Kafka)||Kafka]])** — до версии 0.9 [[Смещение Кафка (Kafka Offset)||offsetы]] хранились в [[Kafka Zookeeper||Zookeeper]]. [[Кафка (Apache Kafka)||Kafka]] использовала [[Kafka Zookeeper||Zookeeper]] для координации работы [[Брокер Кафка (Kafka Broker)||брокеров]] и хранения информации о [[Группа Потербителей Кафка (Kafka Consumer Group)||потребительских группах]] и их смещениях.
  
- **Внутри приложения (в случае кастомных решений)** — иногда приложение может решать хранить [[Смещение Кафка (Kafka Offset)||offsetы]] в других местах, например, в [[База данных (БД, Database, DB)||базах данных]] или [[{TODO} Файловая Система (File System)||файловых системах]], особенно если требуется больше контроля над состоянием.