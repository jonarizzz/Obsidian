**Dead Letter Queue (DLQ)** – это специальная очередь сообщений в [[Очередь Сообщений (Message Queue)||системах очередей]] ([[Кафка (Apache Kafka)||Kafka]], [[{TODO} RabbitMQ||RabbitMQ]], [[{TODO} Amazon SQS||SQS]]), куда попадают необработанные или ошибочные сообщения.


### Зачем нужна

- Сообщение не может быть обработано из-за ошибки.
- Истек таймаут повторных попыток обработки (retry exhausted).
- Поврежденные или некорректные данные (например, [[{TODO} JSON||JSON]] с ошибками).
- Сервис-обработчик не работает длительное время.


### Как работает

1. Сообщение отправляется в основную очередь.
2. Обработчик читает сообщение и пытается обработать.
3. Если обработка не удалась, запускаются повторные попытки (retries).
4. Если после `N` попыток сообщение по-прежнему не обработано, оно отправляется в [[Dead Letter Queue (DLQ)||DLQ]].
5. Из [[Dead Letter Queue (DLQ)||DLQ]] можно:
	1. Ручной разбор проблемных сообщений.
	2. Автоматический reprocess после исправления ошибки.
	3. Анализ логов для диагностики.


### Пример: DLQ в платежной системе

Допустим, у нас есть микросервис, который обрабатывает платежи через [[{TODO} RabbitMQ||RabbitMQ]]:

1. Клиент отправляет платеж (сообщение попадает в основную очередь).
2. Сервис платежей читает сообщение и пытается обработать.
3. Но банк недоступен (например, [[API (Application Programming Interface)||API]] не отвечает).
4. Запускаются повторные попытки (например, 3 раза с интервалом).
5. Если все попытки неудачны, сообщение отправляется в [[Dead Letter Queue (DLQ)||DLQ]].
6. Разработчик анализирует [[Dead Letter Queue (DLQ)||DLQ]], исправляет ошибку и вручную переносит сообщение обратно в основную очередь.


### Когда использовать

- Для устойчивости [[Микросервис (Microservice)||микросервисов]] (чтобы ошибки не блокировали всю систему).
- Для отладки и диагностики (анализ необработанных сообщений).
- Для автоматического повторного запуска задач (reprocessing).
