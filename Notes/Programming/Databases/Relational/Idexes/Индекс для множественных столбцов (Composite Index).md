Индекс для множественных столбцов (Composite Index) — это тип [[Индекс (Index)||индекса]] в [[База данных (Database)||базе данных]], который создается на основе нескольких столбцов таблицы. Такой индекс позволяет эффективно выполнять запросы, которые используют эти столбцы в условиях поиска или сортировки, особенно когда они часто встречаются вместе в запросах.

### Основные особенности:

- **Состав индекса**: Индекс состоит из нескольких столбцов, которые часто используются совместно в запросах. Например, если часто используются запросы, где фильтруются по столбцам city и state, то можно создать индекс, включающий оба этих столбца.
- **Порядок столбцов**: Порядок столбцов в индексе важен. Индекс, состоящий из столбцов `city` и `state`, будет эффективен для запросов, которые фильтруют по `city`, а затем по `state`. Однако, если запрос использует только `state`, индекс может не быть использован или будет менее эффективен.
- **Использование в запросах**: Композитный индекс полезен для запросов, которые фильтруют или сортируют по нескольким столбцам. Однако индекс будет эффективен только если запросы используют столбцы в том же порядке, как они указаны в индексе.

### Составление индекса:

Индекс создается с использованием команды CREATE INDEX с указанием нескольких столбцов:
```sql
CREATE INDEX idx_city_state ON users (city, state);
```


### Размер и производительность:

- Композитные индексы могут занимать больше места, чем [[Индекс по столбцу (Column-store index)||индексы на отдельные столбцы]], поскольку в нем хранятся данные для всех включенных столбцов.
- Они могут ускорить выполнение определенных запросов, но замедлить операции вставки, обновления и удаления, так как индексы требуют обновления при изменении данных.

### Преимущества:

- Ускорение выполнения сложных запросов, которые включают фильтрацию или сортировку по нескольким столбцам.
- Снижение количества индексов, если столбцы часто используются вместе в запросах.

### Ограничения:

Композитный индекс может быть неэффективным, если запросы используют только часть столбцов, входящих в индекс, или если запросы фильтруют столбцы в порядке, отличном от порядка, заданного в индексе.

### Пример использования:

Предположим, у нас есть таблица заказов с полями `customer_id`, `order_date`, и `order_status`. Если запросы часто фильтруются по `customer_id` и `order_date`, то создание композитного индекса будет улучшать производительность:
```sql
CREATE INDEX idx_customer_order_date ON orders (customer_id, order_date);
```

Теперь запросы, которые ищут заказы по определенному клиенту в определенный период времени, будут выполняться быстрее.


### Когда использовать:

- Когда часто выполняются запросы, включающие несколько столбцов в условиях WHERE, JOIN или ORDER BY.
- Когда столбцы в запросах часто встречаются вместе, и использование нескольких [[Индекс (Index)||отдельных индексов]] не будет столь эффективным.

